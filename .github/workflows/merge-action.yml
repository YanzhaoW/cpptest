name: merge action
on:
  push:
    branches: [master]
  workflow_dispatch:

jobs:
  clang_tidy_check:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        repos: [ r3broot, glad ]
        include:
          - repos: r3broot
            url: true
          - repos: glad
    container: 
      image: yanzhaowang/cvmfs_clang:v15
      volumes:
        - /tmp:/cvmfs
      env:
        CVMDIR: /cvmfs/fairsoft.gsi.de
      options: --user root --privileged  --ulimit nofile=10000:10000 --cap-add SYS_ADMIN --device /dev/fuse
    steps: 
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0
      - name: check
        if: matrix.url != 'true'
        run: |
          echo "repos is ${{ matrix.repos }}"
          # git config --global --add safe.directory $GITHUB_WORKSPACE
          # echo $( git rev-parse --short HEAD^)
          # echo $( git rev-parse --short HEAD)
          # echo ${{ github.event_name }}
          # echo "cacheSHA=$([[ ${{github.event_name}} = "push" ]] && git rev-parse --short HEAD || git rev-parse --short HEAD^)"
        shell: bash
